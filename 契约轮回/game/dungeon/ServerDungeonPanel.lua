---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2018/10/10 10:53
---
ServerDungeonPanel = ServerDungeonPanel or class("ServerDungeonPanel", BaseItem)
local this = ServerDungeonPanel

function ServerDungeonPanel:ctor(parent_node)
    self.abName = "dungeon";
    self.image_ab = "dungeon_image";
    self.assetName = "ServerDungeonPanel"
    self.layer = "UI"
    self.panel_type = 2;
    self.model = DungeonModel.GetInstance()
    self.events = {};
    self.schedules = {};

    self.selectedIndex = 1;

    ServerDungeonPanel.super.Load(self)
    --self.sidebar_data = {
    --    {text = ConfigLanguage.Dungeon.CURRENT_SERVER,id = 1,},
    --    {text = ConfigLanguage.Dungeon.INDIVIDUAL,id = 2,},
    --}
    --DungeonCtrl:GetInstance().ServerDungeonPanel = self;
end

function ServerDungeonPanel:dctor()
    self.model = nil;
    GlobalEvent:RemoveTabListener(self.events);
    self:StopAllSchedules()
    if self.content then
        self.content:destroy();
    end
end

function ServerDungeonPanel:Open(data)
    self.data = data;
    WindowPanel.Open(self)
end

function ServerDungeonPanel:LoadCallBack()
    self.nodes = {
        "togLayer/boss_tog_3", "togLayer/boss_tog_2", "togLayer", "togLayer/boss_tog_4", "togLayer/boss_tog_1", "togLayer/boss_tog_6", "togLayer/boss_tog_5", "togLayer/boss_tog_7",
    }
    self:GetChildren(self.nodes)

    SetLocalPosition(self.transform, 0, 0, 0)

    self:InitUI();

    self:AddEvent();

    self:InitTabUI();
end

function ServerDungeonPanel:InitUI()
    self.togList = {};
    for i = 1, 7, 1 do
        self.togList[i] = GetToggle(self["boss_tog_" .. i]);
    end

    --lua_resMgr:SetImageTexture(self, self.winlose, self.image_ab, "dungeon_result2_win", true);
end

local closeTime = 5;
function ServerDungeonPanel:AddEvent()
    local call_back = function(target, bool)
        if bool then
            for j = 1, #self.togList, 1 do
                if target == self.togList[j].gameObject then
                    self.selectedIndex = j;
                    self:InitTabUI();
                end
            end
        end
    end
    for i = 1, 7, 1 do
        AddValueChange(self.togList[i].gameObject, call_back);
    end

    --self.schedules[#self.schedules + 1] = GlobalSchedule:Start(callBack1, 1, -1);

    --AddClickEvent(self.closeBtn.gameObject, call_back);




end


function ServerDungeonPanel:InitTabUI()
    if self.content then
        self.content:destroy();
    end
    self.content = nil;
    if self.selectedIndex == 1 then
        self.content = WorldBossPanel(self.transform, "UI");
    elseif self.selectedIndex == 7 then
        print2("打开掉落记录")

        self.content = DungeonDropLogPanel(self.transform, "UI");
        --self.content =
    else
        Notify.ShowText("Not started")
    end
end

function ServerDungeonPanel:StopAllSchedules()
    for i = 1, #self.schedules, 1 do
        GlobalSchedule:Stop(self.schedules[i]);
    end
    self.schedules = {};
end
