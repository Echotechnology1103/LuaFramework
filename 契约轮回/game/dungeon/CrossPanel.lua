---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 2018/10/10 10:53
---
CrossPanel = CrossPanel or class("CrossPanel", WindowPanel)
local this = CrossPanel
local ConfigLanguage = require('game.config.language.CnLanguage');
function CrossPanel:ctor()
    self.abName = "dungeon";
    self.image_ab = "dungeon_image";
    self.assetName = "DungeonPanel"
    self.layer = "UI"
    self.panel_type = 2;
    self.model = DungeonModel.GetInstance()
    self.sel_idx = nil
    self.events = {};
    self.schedules = {};
end

function CrossPanel:dctor()
    self.sel_idx = nil
    self.model = nil;
    GlobalEvent:RemoveTabListener(self.events);
    self:StopAllSchedules()
    if self.currentView then
        self.currentView:destroy();
    end

    if self.monster then
        self.monster:destroy();
    end
    destroyTab(self.fixDrops);
    self.fixDrops = nil;

    destroyTab(self.dropItems);
    self.dropItems = nil;

    self.valueTab = nil;
    self.labelTab = nil;
end

function CrossPanel:OnDisable()
    if self.map_bg then
        self.map_bg.transform:SetParent(self.transform);
    end
end
function CrossPanel:OnEnable()
    local parent = self.transform:Find("PanelBackgroundTwo(Clone)/img_bg_2");
    if parent then
        self.map_bg.transform:SetParent(parent.transform);
    end
end

function CrossPanel:Open(tab_index, toggle_id, boss_id)
    --if tab_index == 1 then
    --    self.default_table_index = 1;
    --    --没有顶部toggle，为默认选中的boss的idx
    --    --self.default_toggle_index = toggle_id
    --else
    --
    --end
    self.default_table_index = tab_index or 1;
    boss_id = boss_id or 1
    self.selectedBossID = boss_id
    self.default_toggle_index = toggle_id or 3
    WindowPanel.Open(self)
end

function CrossPanel:LoadCallBack()
    self.nodes = {
        "bossView/valueCon/heart", "bossView/valueCon/hit", "bossView/valueCon/def", "bossView/valueCon/dod", "bossView/labelCon/label_4", "bossView/labelCon/label_5",
        "bossView/labelCon/label_6", "awardCon/awardbg", "bossView/labelCon/label_3", "bossView", "awardCon", "dropBtn", "killlog", "bossInfo", "map_bg",
        "bossView/valueCon/attack", "bossView/valueCon/life", "bossView/labelCon/label_1", "awardCon/drops", "awardCon/icon_0", "bossCon", "bossView/labelCon/label_2",
        "staticCon", "staticCon/staticdrops",
        "killtip/tip_text", "killtip",

        "is_care",
    }
    self:GetChildren(self.nodes)

    SetLocalPosition(self.transform, 0, 0, 0)

    --self:SetTileText("副本");
    --self:SetTileTextImage("dungeon_image", "beast_island_title");
    self:InitUI();

    self:AddEvent();

    
    local function call_back(sp)
        self.map_bg.sprite = sp
        if  self.isNeedHideBg then
            SetVisible(self.map_bg,false)
        end
    end
    lua_resMgr:SetImageTexture(self, self.map_bg, "iconasset/icon_big_bg_boss_bg", "boss_bg", false,call_back);
    SetLocalPositionY(self.map_bg.transform, 6)


    self:UpdateReddot();
    --self:SwitchCallBack(1, self.default_tog_index)


end

function CrossPanel:InitUI()
    self.map_bg = GetImage(self.map_bg);
    --原来的的值
    self.valueTab = {}
    self.life = GetText(self.life);
    self.valueTab[2] = self.life;
    self.attack = GetText(self.attack);
    self.valueTab[1] = self.attack;
    self.def = GetText(self.def);
    self.valueTab[3] = self.def;
    self.dod = GetText(self.dod);
    self.valueTab[5] = self.dod;
    self.heart = GetText(self.heart);
    self.valueTab[4] = self.heart;
    self.hit = GetText(self.hit);
    self.valueTab[6] = self.hit;

    self.care = GetToggle(self.is_care);

    self.gridlayoutgroup = GetGridLayoutGroup(self.drops);

    --标签
    self.labelTab = {};
    for i = 1, 6, 1 do
        local name = "label_" .. i;
        self.labelTab[i] = GetText(self[name]);
        if i > 5 then
            self.labelTab[i].gameObject:SetActive(false);
            self.valueTab[i].gameObject:SetActive(false);
        else
            self.valueTab[i].text = "0";
        end
    end

    self.map_bg = GetImage(self.map_bg);

    local parent = self.transform:Find("PanelBackgroundTwo(Clone)/img_bg_2");
    if parent then
        self.map_bg.transform:SetParent(parent.transform);
    end

    self.dropBtn = GetButton(self.dropBtn);
    self.killlog = GetButton(self.killlog);
    self.bossInfo = GetButton(self.bossInfo);

end

function CrossPanel:HaneleBossCare(data)
    if self.selectedIndex == 1 and self.selectedTog == 1 then
        if self.currentView:GetSelectedID() == data.id then
            self:SetIsCare(data.op == 1);
        end
    end
end

function CrossPanel:DropCallBack(target, x, y)
    if self.awardCon then
        --and not self.awardbg.gameObject.activeSelf
        self.bossView.gameObject:SetActive(false);
        self.awardCon.gameObject:SetActive(true);

        if self.selectedIndex ~= 2 then
            SetGameObjectActive(self.killtip, false);
        end
    else
        print2("没有找到awardCon")
    end
    self.dropBtn.gameObject:SetActive(false);
    self.bossInfo.gameObject:SetActive(true);
    if self.selectedIndex == 1 then
        SetGameObjectActive(self.care.gameObject, true);
    end
    SetGameObjectActive(self.bossCon, false);
    if self.selectedIndex == 2 then
        SetGameObjectActive(self.staticCon, true);
    end

    SetGameObjectActive(self.killlog , true);

    if self.outer_drop_callback then
        self.outer_drop_callback()
    end
end

function CrossPanel:BossInfoCallBack()
    if self.bossView then
        --and not self.bossView.gameObject.activeSelf
        self.bossView.gameObject:SetActive(true);
        self.awardCon.gameObject:SetActive(false);
        SetGameObjectActive(self.killtip, false);

    else
        print2("没有找到bossView")
    end
    SetGameObjectActive(self.care.gameObject, false);
    self.dropBtn.gameObject:SetActive(true);
    self.bossInfo.gameObject:SetActive(false);
    SetGameObjectActive(self.bossCon, true);
    SetGameObjectActive(self.staticCon, false);

    SetGameObjectActive(self.killlog , true);

    if self.outer_boss_info_callback then
        self.outer_boss_info_callback()
    end
end

function CrossPanel:BeastCallBack(bool)
    bool = toBool(bool);
    if not bool then
        self:BossInfoCallBack();
    end
    SetGameObjectActive(self.care, bool);
    SetGameObjectActive(self.staticCon, bool);
    SetGameObjectActive(self.bossView, bool);
    SetGameObjectActive(self.awardCon, bool);
    SetGameObjectActive(self.dropBtn , bool);
    SetGameObjectActive(self.bossInfo , bool)
    SetGameObjectActive(self.bossView , bool);
    SetGameObjectActive(self.killlog , bool);
end

function CrossPanel:AddEvent()

    self.events[#self.events + 1] = GlobalEvent.AddEventListener(DungeonEvent.WORLD_BOSS_CARE, handler(self, self.HaneleBossCare));

    AddClickEvent(self.dropBtn.gameObject, handler(self, self.DropCallBack));

    local bossInfo_call_back = function(target, x, y)

    end

    AddClickEvent(self.bossInfo.gameObject, handler(self,self.BossInfoCallBack));

    local killlog_call_back = function(target, x, y)
        print2("show kill log");
        if self.currentView then
            local item = self.currentView.items[self.currentView.selectedItemIndex];
            if item then
                local bossTab = item.data;
                DungeonCtrl:GetInstance():RequestBossKill(bossTab.id);
            else
                Notify.ShowText("Boss is not found");
            end
        end
    end
    AddClickEvent(self.killlog.gameObject, killlog_call_back);

    --先隐藏一种吧
    self:DropCallBack();

    self.events[#self.events + 1] = GlobalEvent.AddEventListener(DungeonEvent.WORLD_BOSS_DROP, handler(self, self.HandleDungeonDrop));

    local function call_back()
        self:Close()
    end
    self.events[#self.events + 1] = GlobalEvent.AddEventListener(DungeonEvent.ENTER_DUNGEON_SCENE, call_back);

    AddEventListenerInTab(EventName.ChangeSceneEnd, handler(self, self.Close), self.events);

    local care_call_back = function(target, bool)
        if not self.robotSetValue and self.selectedIndex == 1 and (self.selectedTog == 1 or self.selectedTog == 5) then
            if bool then
                DungeonCtrl:GetInstance():RequestBossCare(self.currentView:GetSelectedBossType(), self.currentView:GetSelectedID(), 1);
            else
                DungeonCtrl:GetInstance():RequestBossCare(self.currentView:GetSelectedBossType(), self.currentView:GetSelectedID(), 2);
            end
        end
    end
    AddValueChange(self.care.gameObject, care_call_back);
    AddEventListenerInTab(DungeonEvent.UpdateReddot, handler(self, self.UpdateReddot), self.events);
end
CrossPanel.robotSetValue = false;
function CrossPanel:SetIsCare(bool)
    self.robotSetValue = true;
    bool = toBool(bool);
    self.care.isOn = bool;
    self.robotSetValue = false;
end

function CrossPanel:RefreshProp(item)
    local bossTab = item.data;
    local monsterTab = Config.db_creep_attr[bossTab.id];
    self.valueTab[1].text = tostring(monsterTab.att);
    self.valueTab[2].text = tostring(monsterTab.hpmax);
    self.valueTab[3].text = tostring(monsterTab.def);
    self.valueTab[4].text = tostring(monsterTab.hit);
    self.valueTab[5].text = tostring(monsterTab.miss);
end

function CrossPanel:InitModelView(item)
    if item then
        local tab = item.data;
        local monsterTab = Config.db_creep[tab.id];
        local scale = Config.db_boss[tab.id].res_ratio
        if self.monster then
            self.monster:destroy();
        end
        --self.monster = UIMonsterModel(self.bossCon, monsterTab.figure, handler(self, self.HandleMonsterLoaded));
        --self.monster.res_ratio = tab.res_ratio;
        local config = {};
        --config.scale = { x = data.res_ratio, y = data.res_ratio, z = data.res_ratio};
        --config.rotate =  { x = 0, y = 135, z = 0};
        config.pos = { x = -1968, y = -99, z = 300 };
        config.far = 20;
        if self.isPet then
            config.scale = { x = tab.res_ratio, y = tab.res_ratio, z = tab.res_ratio};
            config.rotate = { x = 22, y = 170, z = -8 };
        else
            config.rotate = { x = 0, y = item.yRotate or 135, z = 0 };
            config.scale = { x = scale, y = scale, z = scale};
        end
        config.trans_offset = {x=65.91, y=-26.2}
        config.trans_x = 950
        config.trans_y = 950
        config.carmera_size = 5
        self.monster = UIModelCommonCamera(self.bossCon, nil, monsterTab.figure);--data.icon
        self.monster:SetConfig(config)

        self:SetMoneyConLast(self.transform);
    else
        if self.monster then
            self.monster:destroy();
        end
        self.monster = nil;
    end
end

function CrossPanel:HandleMonsterLoaded()
    SetLocalPosition(self.monster.transform, -1920, -70, 950)
    local v3 = self.monster.transform.localScale;
    if self.monster.res_ratio then
        SetLocalScale(self.monster.transform, self.monster.res_ratio, self.monster.res_ratio, self.monster.res_ratio);
    else
        SetLocalScale(self.monster.transform, 100, 100, 100);
    end

    SetLocalRotation(self.monster.transform, 0, 135, 0);
    self.monster:AddAnimation({ "idle" }, false, nil, 0)

    self:SetMoneyConLast(self.transform);
end

function CrossPanel:InitDrops(item)
    if self.dropItems then
        for k, v in pairs(self.dropItems) do
            v:destroy();
        end
    end
    self.dropItems = {};
    if item then
        local tab = item.data;
        if tab then
            local dropsTab = String2Table(tab.show);
            for i = 1, #dropsTab, 1 do
                local num1 = BagModel:GetInstance():GetItemNumByItemID(dropsTab[i]);
                local aitem = GoodsIconSettorTwo(self.drops.transform)
                local param = {}
                param["item_id"] = dropsTab[i];
                param["can_click"] = true;
                param["bind"] = true;
                param["size"] = { x = 80, y = 80 }
                aitem:SetIcon(param);
                self.dropItems[i] = aitem;
                SetLocalScale(aitem.transform, 1, 1, 1);
            end
        end
    end
    self.icon_0.gameObject:SetActive(false);
end

function CrossPanel:InitPersonalDrops(data)
    destroyTab(self.dropItems);
    self.dropItems = {};
    --local item = self.items[self.selectedItemIndex];
    local tab = data;
    if tab then
        local dropsTab = String2Table(tab.reward_show);
        for i = 1, #dropsTab, 1 do
            local aitem = GoodsIconSettorTwo(self.drops.transform)
            local param = {}
            param["item_id"] = dropsTab[i];
            param["can_click"] = true;
            param["size"] = { x = 80, y = 80 };
            param["bind"] = true;
            aitem:SetIcon(param);
            self.dropItems[i] = aitem;
            SetLocalScale(aitem.transform, 1, 1, 1);
        end
    end
    self.icon_0.gameObject:SetActive(false);
end

function CrossPanel:InitFixDrops(data)
    destroyTab(self.fixDrops);
    self.fixDrops = {};

    local tab = data;
    if tab then
        local dropsTab = String2Table(tab.reward_fixed);
        if #dropsTab == 2 and _G.type(dropsTab[1]) ~= "table" then
            dropsTab = { dropsTab };
        end
        for i = 1, #dropsTab, 1 do
            local drop = dropsTab[i]
            local aitem = AwardItem(self.staticdrops.transform);
            self.fixDrops[i] = aitem;
            aitem:SetData(drop[1], drop[2]);
            --local num1 = BagModel:GetInstance():GetItemNumByItemID(drop[1]);
            --aitem:UpdateNum(num1);
            aitem:AddClickTips();
            --item.transform:SetParent(self.drops.transform);
            SetLocalScale(aitem.transform, 1, 1, 1);
        end
    end
end

function CrossPanel:ShowKillTip(bool)
    SetGameObjectActive(self.killtip, toBool(bool));
end

function CrossPanel:SetBG(item)
    local bossTab = item.data;
    lua_resMgr:SetImageTexture(self, self.map_bg, self.image_ab, "boss_bg", true, nil, false);
end

function CrossPanel:HandleDungeonDrop(data)
    --if self.selectedIndex == 1 and self.selectedTog == 2 then
    --    self.currentView:RefreshData(data);
    --end
    if self.currentView and self.currentView.assetName == "DropLogPanel" then
        local logs = {}
        table.insertto(logs, data.logs, 0)
        table.insertto(logs, TimeBossModel.GetInstance().logs, 0)
        self.currentView:RefreshData(logs);
    end
end

function CrossPanel:ShowThroneView()
    self.isNeedHideBg = true
    self.bossView.gameObject:SetActive(false);
    self.awardCon.gameObject:SetActive(false);
    self.dropBtn.gameObject:SetActive(false);
    self.bossInfo.gameObject:SetActive(false);
    self.bossCon.gameObject:SetActive(false);
    self.killlog.gameObject:SetActive(false);
    --self.map_bg.gameObject:SetActive(false);
    SetVisible(self.map_bg,false)
    SetGameObjectActive(self.staticCon, false);
    SetGameObjectActive(self.killtip, false);
    self:SetTileTextImage("dungeon_image", "ThroneStar_title1")
end

function CrossPanel:ShowWorldBossView()
    self.bossView.gameObject:SetActive(false);
    self.awardCon.gameObject:SetActive(true);
    self.dropBtn.gameObject:SetActive(false);
    self.bossInfo.gameObject:SetActive(true);
    self.bossCon.gameObject:SetActive(false);
    self.killlog.gameObject:SetActive(true);
    self.map_bg.gameObject:SetActive(true);
    SetGameObjectActive(self.staticCon, false);
    SetGameObjectActive(self.killtip, false);
    SetLocalPosition(self.awardCon.transform, 12.3, 102, 0);
    --SetLocalPositionY(self.is_care.transform,-186.7)

    self.gridlayoutgroup.padding.top = 30;
    self.gridlayoutgroup.spacing = { x = 5.22, y = 10.51 };
    self:SetTileTextImage("dungeon_image", "beast_island_title")
    lua_resMgr:SetImageTexture(self, self.map_bg, "iconasset/icon_big_bg_boss_bg", "boss_bg", false)
end

function CrossPanel:ShowTimeBossView()
    --SetLocalPositionY(self.is_care.transform,-238.3)
    SetVisible(self.bossView,false)
    self.awardCon.gameObject:SetActive(false)
    self.bossCon.gameObject:SetActive(false)
    SetGameObjectActive(self.staticCon, false)
    self.killlog.gameObject:SetActive(false)
    self.bossInfo.gameObject:SetActive(false)
    self.map_bg.gameObject:SetActive(true)
    SetGameObjectActive(self.care.gameObject, false)
    self:SetTileTextImage("dungeon_image", "timeboss_title_img")
    lua_resMgr:SetImageTexture(self, self.map_bg, "iconasset/icon_big_bg_boss_bg", "boss_bg", false)
end

function CrossPanel:ShowSiegewarView()
    self.awardCon.gameObject:SetActive(false)
    self.bossCon.gameObject:SetActive(false)
    SetGameObjectActive(self.staticCon, false)
    self.killlog.gameObject:SetActive(false)
    self.bossInfo.gameObject:SetActive(false)
    self.map_bg.gameObject:SetActive(true)
    SetGameObjectActive(self.care.gameObject, false)
    self:SetTileTextImage("dungeon_image", "timeboss_title_img")
    local res = "siegewar__big_bg"
    lua_resMgr:SetImageTexture(self, self.map_bg, "iconasset/icon_big_bg_" .. res, res, false)
end

function CrossPanel:ShowHomeBossView()
    self.bossView.gameObject:SetActive(false);
    self.awardCon.gameObject:SetActive(true);
    self.dropBtn.gameObject:SetActive(false);
    self.bossInfo.gameObject:SetActive(true);
    self.bossCon.gameObject:SetActive(false);
    self.killlog.gameObject:SetActive(true);
    self.map_bg.gameObject:SetActive(true);
    SetGameObjectActive(self.staticCon, false);
    SetGameObjectActive(self.killtip, false);
    SetLocalPosition(self.awardCon.transform, 12.3, 102, 0);

    self.gridlayoutgroup.padding.top = 30;
    self.gridlayoutgroup.spacing = { x = 5.22, y = 10.51 };
end

function CrossPanel:ShowSavageBossView()
    self.bossView.gameObject:SetActive(false);
    self.awardCon.gameObject:SetActive(true);
    self.dropBtn.gameObject:SetActive(false);
    self.bossInfo.gameObject:SetActive(true);
    self.bossCon.gameObject:SetActive(false);
    self.killlog.gameObject:SetActive(true);
    self.map_bg.gameObject:SetActive(true);
    SetGameObjectActive(self.staticCon, false);
    SetGameObjectActive(self.killtip, false);
    --SetLocalPosition(self.awardCon.transform, 12.3, 152, 0);
    SetLocalPosition(self.awardCon.transform, 12.3, 102, 0);
    self.gridlayoutgroup.padding.top = 30;
    self.gridlayoutgroup.spacing = { x = 5.22, y = 10.51 };
end

function CrossPanel:ShowSpacetimeCrackView(  )
    self:ShowSavageBossView()
    self:SetTileTextImage("dungeon_image", "SpacetimeCrack_Title")
end

function CrossPanel:ShowDropView()
    self.bossView.gameObject:SetActive(false);
    self.awardCon.gameObject:SetActive(false);
    self.dropBtn.gameObject:SetActive(false);
    self.bossInfo.gameObject:SetActive(false);
    self.bossCon.gameObject:SetActive(false);
    self.killlog.gameObject:SetActive(false);
    self.map_bg.gameObject:SetActive(false);
    SetGameObjectActive(self.staticCon, false);
    SetGameObjectActive(self.killtip, false);
    SetLocalPosition(self.awardCon.transform, 12.3, 152, 0);

    self.gridlayoutgroup.padding.top = 30;
    self.gridlayoutgroup.spacing = { x = 5.22, y = 10.51 };
end

function CrossPanel:ShowPersonalBossView()
    self.bossView.gameObject:SetActive(false);
    self.awardCon.gameObject:SetActive(true);
    self.dropBtn.gameObject:SetActive(false);
    self.bossInfo.gameObject:SetActive(true);
    self.bossCon.gameObject:SetActive(false);
    self.killlog.gameObject:SetActive(false);
    self.map_bg.gameObject:SetActive(true);
    SetGameObjectActive(self.staticCon, true);
    SetGameObjectActive(self.killtip, false);
    --GridLayoutGroup g;

    self.gridlayoutgroup.padding.top = 0;
    self.gridlayoutgroup.spacing = { x = 0, y = 0 };
    SetLocalPosition(self.awardCon.transform, 12.3, 0, 0);
end

function CrossPanel:ShowPetBossView()
    self.bossView.gameObject:SetActive(false);
    self.awardCon.gameObject:SetActive(true);
    self.dropBtn.gameObject:SetActive(false);
    self.bossInfo.gameObject:SetActive(true);
    self.bossCon.gameObject:SetActive(false);
    self.killlog.gameObject:SetActive(true);
    self.map_bg.gameObject:SetActive(true);
    SetGameObjectActive(self.staticCon, false);
    SetGameObjectActive(self.killtip, false);

    SetLocalPosition(self.awardCon.transform, 12.3, 102, 0);

    self.gridlayoutgroup.padding.top = 30;
    self.gridlayoutgroup.spacing = { x = 5.22, y = 10.51 };
end
--

--
--function CrossPanel:ShowModel(bool)
--    bool = toBool(bool);
--    self.bossCon.gameObject:SetActive(bool);
--end

function CrossPanel:StopAllSchedules()
    for i = 1, #self.schedules, 1 do
        GlobalSchedule:Stop(self.schedules[i]);
    end
    self.schedules = {};
end

function CrossPanel:AfterOpen()
    CrossPanel.super.AfterOpen(self);
    self.default_table_index = nil;
    self.default_toggle_index = nil;
    self.selectedBossID = nil;
end

function CrossPanel:SwitchCallBack(index, toggle_id, update_toggle)
    if toggle_id then
        if index == self.selectedIndex and toggle_id == self.selectedTog then
            return
        end
    else
        if index == self.selectedIndex then
            return
        end
    end
    if self.currentView then
        self.currentView:destroy();
    end
    self.currentView = nil

    self.outer_boss_info_callback = nil
    self.outer_drop_callback = nil

    if index == 1 then
        if toggle_id == 1 then
            self.currentView = BeastIslandPanel(self.transform, self, self.selectedBossID , true);
            self.default_toggle_index = nil
            self:PopUpChild(self.currentView);
            self.selectedIndex = 1;
            self.selectedTog = toggle_id;
            self:ShowWorldBossView();
        elseif toggle_id == 2 then
            self.selectedIndex = 1;
            self.selectedTog = toggle_id;
            self.currentView = DungeonDropLogPanel(self.transform, "UI" , true);
            self:ShowDropView();
            self:PopUpChild(self.currentView);
        elseif toggle_id == 3 then
            self.currentView = TimeBossPanel(self.transform)
            self.currentView:SetData(self.selectedBossID)
            self:PopUpChild(self.currentView)
            self.selectedIndex = 1
            self.selectedTog = toggle_id
            self:ShowTimeBossView()
        elseif toggle_id == 4 then
            self.currentView = ThroneStarPanel(self.transform)
            self.currentView:SetData(self.selectedBossID)
            self:PopUpChild(self.currentView)
            self.selectedIndex = 1
            self.selectedTog = toggle_id
            self:ShowThroneView()

            --self.currentView = SiegewarPanel(self.transform)
            ----self.currentView:SetData(self.selectedBossID)
            --self:PopUpChild(self.currentView)
            --self.selectedIndex = 1
            --self.selectedTog = toggle_id
            --self:ShowSiegewarView()
        elseif toggle_id == 5 then
            --时空裂缝
            self.currentView = SpacetimeCrackDungePanel(self.transform, self, self.selectedBossID)
            self:PopUpChild(self.currentView)
            self.selectedIndex = 1
            self.selectedTog = toggle_id
            self:ShowSpacetimeCrackView()

            --self:ShowDropView();
        end 

        
    end
end

function CrossPanel:UpdateReddot()
    local tab = DungeonModel:GetInstance().red_dot_list;
    local show1 = tab[enum.BOSS_TYPE.BOSS_TYPE_BEAST_CROSS]
    local show2 = tab[enum.SCENE_STYPE.SCENE_STYPE_TIMEBOSS]
    --local show3 = tab[enum.SCENE_STYPE.SCENE_STYPE_SIEGEWAR]
    local lv = RoleInfoModel.GetInstance():GetMainRoleLevel()
    local nedlv = GetSysOpenDataById("160@15")
    if lv < nedlv then
        show1 = false
    end
	self:SetIndexRedDotParam(1, show1 or show2)
    self:SetToggleRedDotParam(1, 1, show1)
    self:SetToggleRedDotParam(1, 3, show2)
    --self:SetToggleRedDotParam(1, 4, show3)

    --时空裂缝红点
    local show5 = DungeonModel.GetInstance():CheckpaceTimeCrackReddot()
    self:SetToggleRedDotParam(1, 5, show5)
end

function CrossPanel:ShowOrHideCare(flag)
    SetGameObjectActive(self.care, flag);
end
