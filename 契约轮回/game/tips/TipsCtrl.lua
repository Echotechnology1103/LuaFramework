---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 18/11/10 10:57
---

require("game/tips/RequireTips");

TipsCtrl = TipsCtrl or class("TipsCtrl", BaseController)
local this = TipsCtrl


function TipsCtrl:ctor()
    TipsCtrl.Instance = self;
    self.events = {};
    self:AddEvents()
    self:RegisterAllProtocal();
end

function TipsCtrl:dctor()
    GlobalEvent:RemoveTabListener(self.events);
end

function TipsCtrl:GetInstance()
    if not TipsCtrl.Instance then
        TipsCtrl()
    end
    return TipsCtrl.Instance;
end

function TipsCtrl:RegisterAllProtocal()

end

function TipsCtrl:AddEvents()
    AddEventListenerInTab(ChatEvent.ReceiveMessage , handler(self,self.HandleChat) , self.events);

    local function call_back()
        TipsManager.wait_show_tips = {};
        if TipsManager.showingTips then
            for k,v in pairs(TipsManager.showingTips) do
                v:destroy();
            end
        end
        TipsManager.showingTips = {};
    end
    GlobalEvent:AddListener(EventName.GameReset, call_back)
end

function TipsCtrl:HandleChat(data)
    if data and data.show_type then
        if data.channel_id == enum.CHAT_CHANNEL.CHAT_CHANNEL_SYS then
            TipsManager.ShowHorseRaceTip(data.content , 2);
        end
    end
end
