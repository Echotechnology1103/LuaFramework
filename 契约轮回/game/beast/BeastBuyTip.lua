---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by win 10.
--- DateTime: 19/01/21 10:13
---
--- 自动生成
--- Generated by ling live template
--- Created by win 10.
--- DateTime: 19/01/21 10:13
---

BeastBuyTip = BeastBuyTip or class("BeastBuyTip", WindowPanel)--BaseItem
local this = BeastBuyTip
BeastBuyTip.ITEM_ID = 30015;
function BeastBuyTip:ctor(parent_node)
    self.abName = "beast";
    self.image_ab = "beast_image";
    self.assetName = "BeastBuyTip"
    self.layer = "UI"
    self.items = {};

    self.model = BeastModel.GetInstance()
    self.events = {};
    self.schedules = {};
    self.panel_type = 4;

    --BeastBuyTip.super.Load(self);
end

function BeastBuyTip:dctor()
    self.model = nil;

    GlobalEvent:RemoveTabListener(self.events);
    self:StopAllSchedules()

    if self.item then
        self.item:destroy();
    end
end

function BeastBuyTip:Open(data)
    self.data = data;
    WindowPanel.Open(self)
end

function BeastBuyTip:LoadCallBack()
    self.nodes = {
        "contentText", "icon", "sure",
    }
    self:GetChildren(self.nodes);

    SetLocalPosition(self.transform, 0, 0, 0);

    self:InitUI();

    self:AddEvent();

    self:SetTileTextImage(self.image_ab, "beast_buy_title");
    --AddBgMask(self.gameObject,20,20,20,185);
end

function BeastBuyTip:AddEvent()
    AddClickEvent(self.sure.gameObject, handler(self, self.HandleAddMaxSummon));

end
--消耗<color=#2CA321>异兽助战卡</color>永久增加<color=#2CA321>1</color>个助战异兽
--
--
--
--
--（<color=#2CA321>30</color>级时可额外增加第<color=#2CA321>2</color>个异兽助战位置）
function BeastBuyTip: InitUI()
    self.contentText = GetText(self.contentText);
    self.sure = GetButton(self.sure);
    local itemConfig = Config.db_item[BeastBuyTip.ITEM_ID];
    local data = self.data;
    local restrict = String2Table(data.restrict);
    local level = restrict[2];
    local cost = String2Table(self.data.cost)
    local itemID = cost[1];
    local need = cost[2];
    self.item = GoodsIconSettorTwo(self.icon);
    local param = {}
    param["item_id"] = itemID;
    param["can_click"] = true;
    local num = BagModel:GetInstance():GetItemNumByItemID(BeastBuyTip.ITEM_ID);
    if num >= need then
        --self.item:SetNumText(num .. "/" .. need);
        param["num"] = num .. "/" .. need;
    else
        --self.item:SetNumText(num .. "/<color=#ff0000>" .. need .. "</color>");
        param["num"] = num .. "/<color=#ff0000>" .. need .. "</color>";
    end

    param["bind"] = true;
    param["size"] = { x = 80, y = 80 }
    self.item:SetIcon(param);

    --self.item:SetData(30015, 0);

    --self.item:ShowTextBg(true);

    self.contentText.text = "Consume <color=#2CA321>" .. (itemConfig and itemConfig.name or "Assisting Beast Card") .. "</color> and add <color=#2CA321>1</color> beast slot permanently" .. "\n\n\n\n\n" .. "（<color=#2CA321>" .. GetLevelShow(tonumber(level)) .. "</Color>to add <color=#2CA321>" .. (self.data.slot - 3) .. "</color>another additional beast slot)"
end

--@ling autofun
function BeastBuyTip:HandleAddMaxSummon(go, x, y)
    local num = BagModel:GetInstance():GetItemNumByItemID(30015);
    if num > 0 then
        BeastCtrl:GetInstance():RequestAddSummon();
    else
        Notify.ShowText("You don't have enough beast assistance cards");
    end
    self:Close();
end

function BeastBuyTip:StopAllSchedules()
    for i = 1, #self.schedules, 1 do
        GlobalSchedule:Stop(self.schedules[i]);
    end
    self.schedules = {};
end

