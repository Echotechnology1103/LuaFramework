RoleReNamePanel = RoleReNamePanel or class("RoleReNamePanel", WindowPanel)
local this = RoleReNamePanel

function RoleReNamePanel:ctor(parent_node, parent_panel)
	self.abName = "roleinfo"
	self.assetName = "RoleReNamePanel"
	self.layer = "UI"
	self.use_background = true
	self.change_scene_close = true
	self.panel_type = 4
	self.events = {}
	self.model = RoleInfoModel:GetInstance()
	--self.role_data = RoleInfoModel:GetInstance():GetMainRoleData()
end

function RoleReNamePanel:dctor()
	GlobalEvent:RemoveTabListener(self.events)
end

---type == 1物品直接使用  2按钮弹出
function RoleReNamePanel:Open(type)
	self.type = type
	RoleReNamePanel.super.Open(self)
end


function RoleReNamePanel:LoadCallBack()
	self.nodes = {
		"okBtn","qxBtn","curName","CreateName/InputField",
		"CreateName/nameDefault"
	}
	self:GetChildren(self.nodes)
	self.curName = GetText(self.curName)
	self.InputIpt = self.InputField:GetComponent('InputField')
	self:SetTileTextImage("roleinfo_image", "roleinfo_rename_title");
	self:InitUI()
	self:AddEvent()                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
end

function RoleReNamePanel:InitUI()
	local Role = self.model:GetMainRoleData()
	self.curName.text = string.format("<color=#0DAB18>%s</color>,your name echoes through the Titan's Realm. Change a name?",Role.name) 
end

function RoleReNamePanel:AddEvent()
	
	local function call_back()  --确定改名
		
		local name = self.InputIpt.text
		if #name == 0 then
			Notify.ShowText("Enter a new name")
			return
		end
		local oneLen = string.len("Me")
		local limitLen = oneLen * 6
		local name1 = string.gsub(self.InputIpt.text, "^%s*(.-)%s*$", "%1")
		local len1 = string.len(name1)
		local name2 = string.filterSpeChars(name1)
		local len2 = string.len(name2)
		if len1 ~= len2 then
			Notify.ShowText("Improper contents found in your guild name")
			return
		end
		
		if not FilterWords:GetInstance():isSafe(name2) then
			Notify.ShowText("Improper contents found in your guild name")
			return
		end	
		if self.type == 1 then
			RoleInfoController.GetInstance():RequestRoleRename(name2)
		else
			local itemNum  = BagModel:GetInstance():GetItemNumByItemID(11002) or 0
			if itemNum <= 0 then  --没有改名卡
				local price = Config.db_voucher[11002].price
				local type = Config.db_voucher[11002].type
				local function call_back()
					if RoleInfoModel:GetInstance():CheckGold(price,type) then
						RoleInfoController.GetInstance():RequestRoleRename(name2)
					end
				end
				Dialog.ShowTwo("Tip", string.format("You don't have enough name changing cards.Sure to cost <color=#0DAB18>%s diamonds</color> to buy：<color=#0DAB18>Rename Card*1</color>. Continue changing name",price), "Continue changing name", call_back, nil, "Think again", nil, nil)
			else
				RoleInfoController.GetInstance():RequestRoleRename(name2)
			end
			
			
		end
		
	end
	AddClickEvent(self.okBtn.gameObject,call_back)
	
	local function call_back()  --确定改名
		self:Close()
	end
	AddClickEvent(self.qxBtn.gameObject,call_back)
	
	
	local function call_back(str)
		if str ~= "" then
			SetVisible(self.nameDefault.gameObject,false)
			
		end
	end
	self.InputIpt.onValueChanged:AddListener(call_back)
	
	local function call_back(str)
		if str == "" then
			SetVisible(self.nameDefault.gameObject,true)
		end
	end
	self.InputIpt.onEndEdit:AddListener(call_back)
	
	self.events[#self.events + 1] =  GlobalEvent:AddListener(RoleInfoEvent.RoleReName,handler(self,self.RoleReName))
	
end

function RoleReNamePanel:RoleReName()
	self:Close()
	--Notify.ShowText("公会名字修改成功")
end