local report = {	
    ["tp"] = 2,	
    ["result"] = {	
        ["left_own_teams"] = {	
            ["units"] = {	
                [1] = {	
                    ["anger"] = 2,	
                    ["hp"] = 1879,	
                    ["position"] = 1,	
                    ["id"] = 40004,	
                },	
                [2] = {	
                    ["anger"] = 1,	
                    ["hp"] = 1907,	
                    ["position"] = 2,	
                    ["id"] = 40026,	
                },	
                [3] = {	
                    ["anger"] = 1,	
                    ["hp"] = 5558,	
                    ["position"] = 0,	
                    ["id"] = 1,	
                },	
            },	
        },	
    },	
    ["bouts"] = {	
        [1] = {	
            ["own_team"] = 0,	
            ["rounds"] = {	
                [1] = {	
                    ["attacks"] = {	
                        [1] = {	
                            ["identity"] = 1,	
                            ["skill_id"] = 1,	
                            ["position"] = 0,	
                            ["anger"] = 3,	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 2,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 135,	
                                },	
                            },	
                        },	
                        [2] = {	
                            ["identity"] = 1,	
                            ["skill_id"] = 400011,	
                            ["position"] = 1,	
                            ["anger"] = 5,	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 2,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 247,	
                                },	
                            },	
                            ["buff_victims"] = {	
                                [1] = {	
                                    ["identity"] = 2,	
                                    ["is_resist"] = true,	
                                    ["position"] = 1,	
                                    ["id"] = 1,	
                                    ["buff_id"] = 29001,	
                                },	
                            },	
                        },	
                        [3] = {	
                            ["identity"] = 2,	
                            ["skill_id"] = 14,	
                            ["position"] = 1,	
                            ["anger"] = 4,	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 0,	
                                    ["change_hp"] = 1,	
                                },	
                                [2] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 279,	
                                },	
                                [3] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 2,	
                                    ["change_hp"] = 318,	
                                },	
                            },	
                        },	
                        [4] = {	
                            ["identity"] = 1,	
                            ["skill_id"] = 400231,	
                            ["position"] = 2,	
                            ["anger"] = 5,	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 2,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 286,	
                                },	
                            },	
                        },	
                    },	
                },	
                [2] = {	
                    ["attacks"] = {	
                        [1] = {	
                            ["identity"] = 1,	
                            ["skill_id"] = 1,	
                            ["position"] = 0,	
                            ["anger"] = 5,	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 2,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 147,	
                                },	
                            },	
                        },	
                        [2] = {	
                            ["identity"] = 1,	
                            ["skill_id"] = 400014,	
                            ["position"] = 1,	
                            ["buff_victims"] = {	
                                [1] = {	
                                    ["identity"] = 2,	
                                    ["is_resist"] = true,	
                                    ["position"] = 1,	
                                    ["id"] = 2,	
                                    ["buff_id"] = 29001,	
                                },	
                            },	
                            ["anger_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 1,	
                                    ["anger"] = 1,	
                                },	
                            },	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["identity"] = 2,	
                                    ["position"] = 1,	
                                    ["state"] = true,	
                                    ["change_hp"] = 1355,	
                                    ["is_crit"] = true,	
                                },	
                            },	
                            ["unite_index"] = {	
                                [1] = 2,	
                            },	
                            ["anger"] = 2,	
                        },	
                        [3] = {	
                            ["identity"] = 2,	
                            ["skill_id"] = 15,	
                            ["position"] = 1,	
                            ["anger_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 2,	
                                    ["position"] = 1,	
                                    ["anger"] = 1,	
                                },	
                            },	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 0,	
                                    ["change_hp"] = 1,	
                                },	
                                [2] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 848,	
                                },	
                                [3] = {	
                                    ["state"] = true,	
                                    ["identity"] = 1,	
                                    ["position"] = 2,	
                                    ["change_hp"] = 891,	
                                },	
                            },	
                            ["anger"] = 1,	
                        },	
                        [4] = {	
                            ["identity"] = 1,	
                            ["skill_id"] = 400232,	
                            ["position"] = 2,	
                            ["anger_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 2,	
                                    ["position"] = 1,	
                                    ["anger"] = 0,	
                                },	
                            },	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = true,	
                                    ["identity"] = 2,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 663,	
                                },	
                            },	
                            ["anger"] = 1,	
                        },	
                    },	
                },	
                [3] = {	
                    ["attacks"] = {	
                        [1] = {	
                            ["identity"] = 1,	
                            ["skill_id"] = 10000,	
                            ["position"] = 0,	
                            ["anger"] = 1,	
                            ["state"] = true,	
                            ["skill_victims"] = {	
                                [1] = {	
                                    ["state"] = false,	
                                    ["identity"] = 2,	
                                    ["position"] = 1,	
                                    ["change_hp"] = 210,	
                                },	
                            },	
                        },	
                    },	
                },	
            },	
            ["enemy_team"] = 0,	
        },	
    },	
    ["is_win"] = true,	
    ["own_name"] = "zb1",	
    ["enemy_teams"] = {	
        [1] = {	
            ["units"] = {	
                [1] = {	
                    ["anger"] = 2,	
                    ["hp"] = 3000,	
                    ["position"] = 1,	
                    ["id"] = 9501,	
                },	
            },	
        },	
    },	
    ["own_teams"] = {	
        [1] = {	
            ["units"] = {	
                [1] = {	
                    ["position"] = 0,	
                    ["anger"] = 1,	
                    ["hp"] = 5560,	
                    ["id"] = 1,	
                    ["dress_id"] = 0,	
                },	
                [2] = {	
                    ["position"] = 1,	
                    ["anger"] = 3,	
                    ["hp"] = 3006,	
                    ["id"] = 40004,	
                    ["dress_id"] = 0,	
                    ["name"] = G_lang:get("LANG_REPORT_NAME_LVBU"),
                },	
                [3] = {	
                    ["position"] = 2,	
                    ["anger"] = 3,	
                    ["hp"] = 3116,	
                    ["id"] = 40026,	
                    ["dress_id"] = 0,
                    ["name"] = G_lang:get("LANG_REPORT_NAME_DIAOCHAN"),
                },	
            },	
        },	
    },	
}

require "app.cfg.knight_info"

report.own_name = G_Me.userData.name

-- 先登记当前战报中默认选中的主角的技能
local mainKnight = knight_info.get(report.own_teams[1].units[1].id)

local skills = {
    common_id = mainKnight.common_id,
    active_skill_id = mainKnight.active_skill_id
}

-- 更换主角id
local _, baseId = G_Me.formationData:getTeamKnightIdAndBaseIdByIndex(1, 1)

if baseId ~= report.own_teams[1].units[1].id then

    -- 上阵阵容的主角
    report.own_teams[1].units[1].id = baseId

    -- 剩余人数的主角
    report.result.left_own_teams.units[3].id = baseId

    -- 遍历战报，更换技能
    for i=1, #report.bouts do
        local bout = report.bouts[i]
        for j=1, #bout.rounds do
            local round = bout.rounds[j]
            for s=1, #round.attacks do
                local attack = round.attacks[s]
                -- 主角的出手
                if attack.identity == 1 and attack.position == 0 then
                    -- 普通技能
                    if attack.skill_id == skills.common_id then
                        attack.skill_id = knight_info.get(baseId).common_id
                    -- 主动技能
                    elseif attack.skill_id == skills.active_skill_id then
                        attack.skill_id = knight_info.get(baseId).active_skill_id
                    else
                        assert(false, "Unknown skill with skill_id: "..attack.skill_id)
                    end
                end
            end
        end
    end

end

return report
