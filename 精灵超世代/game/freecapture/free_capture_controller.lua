---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2022/2/28 17:50
---

FreeCaptureController = FreeCaptureController or BaseClass(BaseController)

function FreeCaptureController:config()
    self.model = FreeCaptureModel.New(self)
end

function FreeCaptureController:getModel()
    return self.model
end

function FreeCaptureController:registerEvents()

end

function FreeCaptureController:registerProtocals()
    self:RegisterProtocal(23240, "handle23240")
    self:RegisterProtocal(23241, "handle23241")
end

function FreeCaptureController:sender23240()
    --print("请求免费捕捉数据！")
    self:SendProtocal(23240, {})
end

function FreeCaptureController:handle23240(data)
    --dump(data, "下发免费捕捉数据！")
    if data ~= nil and next(data) ~= nil then
        if data.info_list and next(data.info_list) ~= nil then
            local tip = false
            for i,v in ipairs(data.info_list) do
                if v.status == 1 then
                    tip = true
                    break
                end
            end
            MainuiController:getInstance():setFunctionTipsStatus(MainuiConst.icon.free_capture, tip)
        end
        GlobalEvent:getInstance():Fire(FreeCaptureEvent.Free_Capture_Data, data)
    end
end

function FreeCaptureController:sender23241(lev)
    --print("请求免费捕捉数据！", lev)
    local protocal = {}
    protocal.lev = lev
    self:SendProtocal(23241, protocal)
end

function FreeCaptureController:handle23241(data)
    --dump(data, "下发免费捕捉结果！")
    if data ~= nil and next(data) ~= nil then
        --GlobalEvent:getInstance():Fire(FreeCaptureEvent.Free_Capture_Result, data)
    end
end

--打开免费捕捉界面
function FreeCaptureController:openFreeCaptureWindow(status)
    if status == true then
        if not self.free_capture_window then
            self.free_capture_window = FreeCaptureWindow.New()
        end
        self.free_capture_window:open()
    else
        if self.free_capture_window then
            self.free_capture_window:close()
            self.free_capture_window = nil
        end
    end
end

function FreeCaptureController:__delete()
    if self.model ~= nil then
        self.model:DeleteMe()
        self.model = nil
    end
end