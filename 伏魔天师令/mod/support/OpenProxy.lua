_G.Cfg.P_SYS_ARRAY={
    --攻略
    [_G.Const.CONST_FUNC_OPEN_STRATEGY_CALENDAR]={id=_G.Const.CONST_FUNC_OPEN_STRATEGY,_data1=712},
    [_G.Const.CONST_FUNC_OPEN_STRATEGY_ACTIVE]={id=_G.Const.CONST_FUNC_OPEN_STRATEGY,_data1=711},
    [_G.Const.CONST_FUNC_OPEN_STRATEGY_STRONG]={id=_G.Const.CONST_FUNC_OPEN_STRATEGY,_data1=711},
    --设置
    [_G.Const.CONST_FUNC_OPEN_SETING_UPDATE]={id=_G.Const.CONST_FUNC_OPEN_SETING},
    [_G.Const.CONST_FUNC_OPEN_SETING_CONTACT_GM]={id=_G.Const.CONST_FUNC_OPEN_SETING},
    [_G.Const.CONST_FUNC_OPEN_SETING_SUBMIT_BUG]={id=_G.Const.CONST_FUNC_OPEN_SETING},
    [_G.Const.CONST_FUNC_OPEN_SETING_WEIXING]={id=_G.Const.CONST_FUNC_OPEN_SETING},
    --角色
    [_G.Const.CONST_FUNC_OPEN_ROLE_ATTRIBUTE]={id=_G.Const.CONST_FUNC_OPEN_ROLE},
    [_G.Const.CONST_FUNC_OPEN_SMITHY_STRENGTHEN]={id=_G.Const.CONST_FUNC_OPEN_ROLE,_data1=2},
    [_G.Const.CONST_FUNC_OPEN_ROLE_TITLE]={id=_G.Const.CONST_FUNC_OPEN_ROLE,_data1=5},
    [_G.Const.CONST_FUNC_OPEN_ROLE_SKILL]={id=_G.Const.CONST_FUNC_OPEN_ROLE,_data1=3},
    [_G.Const.CONST_FUNC_OPEN_ROLE_GOLD]={id=_G.Const.CONST_FUNC_OPEN_ROLE,_data1=4},
    --湛卢坊
    [_G.Const.CONST_FUNC_OPEN_ROLE_EQUIP]={id=_G.Const.CONST_FUNC_OPEN_SMITHY},
    [_G.Const.CONST_FUNC_OPEN_SMITHY_QUALITY]={id=_G.Const.CONST_FUNC_OPEN_SMITHY,_data1=2},
    [_G.Const.CONST_FUNC_OPEN_SMITHY_INLAY]={id=_G.Const.CONST_FUNC_OPEN_SMITHY,_data1=3},
    [_G.Const.CONST_FUNC_OPEN_SMITHY_ENCHANTS]={id=_G.Const.CONST_FUNC_OPEN_SMITHY,_data1=4},
    [_G.Const.CONST_FUNC_OPEN_SMITHY_RESOLVE]={id=_G.Const.CONST_FUNC_OPEN_SMITHY,_data1=5},
    --背包
    [_G.Const.CONST_FUNC_OPEN_BAG_PROP]={id=_G.Const.CONST_FUNC_OPEN_BAG},
    [_G.Const.CONST_FUNC_OPEN_BAG_GEM]={id=_G.Const.CONST_FUNC_OPEN_BAG},
    [_G.Const.CONST_FUNC_OPEN_BAG_EQUIP]={id=_G.Const.CONST_FUNC_OPEN_BAG},
    [_G.Const.CONST_FUNC_OPEN_BAG_REPURCHASE]={id=_G.Const.CONST_FUNC_OPEN_BAG},
    [_G.Const.CONST_FUNC_OPEN_BAG_COMPOSE]={id=_G.Const.CONST_FUNC_OPEN_BAG},
    --任务
    [_G.Const.CONST_FUNC_OPEN_TASK_THREAD]={id=_G.Const.CONST_FUNC_OPEN_TASK},
    [_G.Const.CONST_FUNC_OPEN_TASK_FEEDER]={id=_G.Const.CONST_FUNC_OPEN_TASK},
    [_G.Const.CONST_FUNC_OPEN_TASK_DAILY]={id=_G.Const.CONST_FUNC_OPEN_TASK,_data1 = 1},
    --卦象
    [_G.Const.CONST_FUNC_OPEN_SHEN_UP]={id=_G.Const.CONST_FUNC_OPEN_SHEN,_data1 = 2},
    [_G.Const.CONST_FUNC_OPEN_SHEN_QUALITY]={id=_G.Const.CONST_FUNC_OPEN_SHEN,_data1 = 3},
    --灵妖
    [_G.Const.CONST_FUNC_OPEN_PARTNER_ATTRIBUTE]={id=_G.Const.CONST_FUNC_OPEN_PARTNER},
    [_G.Const.CONST_FUNC_OPEN_PARTNER_CHEER]={id=_G.Const.CONST_FUNC_OPEN_PARTNER,_data1=2},
    [_G.Const.CONST_FUNC_OPEN_PARTNER_ADVANCED]={id=_G.Const.CONST_FUNC_OPEN_PARTNER,_data1=3},
    [_G.Const.CONST_FUNC_OPEN_PARTNER_SOUL]={id=_G.Const.CONST_FUNC_OPEN_PARTNER,_data1=4},
    [_G.Const.CONST_FUNC_OPEN_PARTNER_ATLAS]={id=_G.Const.CONST_FUNC_OPEN_PARTNER,_data1=5},
    --门派
    [_G.Const.CONST_FUNC_OPEN_GANGS_ACTIVITY]={id=_G.Const.CONST_FUNC_OPEN_GANGS,_data2=4},
    [_G.Const.CONST_FUNC_OPEN_GANGS_BOSS]={id=_G.Const.CONST_FUNC_OPEN_GANGS,_data2=4,_data3=1},
    [_G.Const.CONST_FUNC_OPEN_GANGS_KING]={id=_G.Const.CONST_FUNC_OPEN_GANGS,_data2=4,_data3=2},
    [_G.Const.CONST_FUNC_OPEN_GANGS_DEFEND]={id=_G.Const.CONST_FUNC_OPEN_GANGS,_data2=4,_data3=3},
    [_G.Const.CONST_FUNC_OPEN_GANGS_QIFU]={id=_G.Const.CONST_FUNC_OPEN_GANGS,_data2=4,_data3=4},
    [_G.Const.CONST_FUNC_OPEN_GANGS_WAR]={id=_G.Const.CONST_FUNC_OPEN_GANGS,_data2=4,_data3=5},
    [_G.Const.CONST_FUNC_OPEN_GANGS_SKILL]={id=_G.Const.CONST_FUNC_OPEN_GANGS,_data2=5},
    --好友
    [_G.Const.CONST_FUNC_OPEN_FRIEND_WISH]={id=_G.Const.CONST_FUNC_OPEN_FRIEND},
    --大闹天宫
    [_G.Const.CONST_FUNC_OPEN_WELKIN_FIRST]={id=_G.Const.CONST_MAP_WELKIN_FIRST},
    [_G.Const.CONST_FUNC_OPEN_WELKIN_BATTLE]={id=_G.Const.CONST_MAP_WELKIN_BATTLE},
    [_G.Const.CONST_FUNC_OPEN_WELKIN_ONLY]={id=_G.Const.CONST_MAP_WELKIN_ONLY},
    --副本
    [_G.Const.CONST_FUNC_OPEN_COPY]={id=_G.Cfg.UI_CCopyMapLayer},
    [_G.Const.CONST_FUNC_OPEN_COPY_COMMON]={id=_G.Cfg.UI_CCopyMapLayer},
    [_G.Const.CONST_FUNC_OPEN_COPY_NIGHTMARE]={id=_G.Cfg.UI_CCopyMapLayer},
    [_G.Const.CONST_FUNC_OPEN_COPY_HELL]={id=_G.Cfg.UI_CCopyMapLayer},
    [_G.Const.CONST_FUNC_OPEN_COPY_JEWELLERY]={id=_G.Cfg.UI_CCopyMapLayer},
    --勾魂使者
    [_G.Const.CONST_FUNC_OPEN_BOSS_SHIJIE]={id=_G.Const.CONST_FUNC_OPEN_BOSS,_data1=1},
    [_G.Const.CONST_FUNC_OPEN_BOSS_CHENGZHEN]={id=_G.Const.CONST_FUNC_OPEN_BOSS,_data1=2},
    --福利
    [_G.Const.CONST_FUNC_OPEN_REWARD_ON_LINE]={id=_G.Const.CONST_FUNC_OPEN_WELFARE,_data1=1},
    [_G.Const.CONST_FUNC_OPEN_REWARD_SIGN]={id=_G.Const.CONST_FUNC_OPEN_WELFARE,_data1=2},
    [_G.Const.CONST_FUNC_OPEN_REWARD_LV]={id=_G.Const.CONST_FUNC_OPEN_WELFARE,_data1=3},
    [_G.Const.CONST_FUNC_OPEN_NOVICE]={id=_G.Const.CONST_FUNC_OPEN_WELFARE,_data1=4},
    --充值
    [_G.Const.CONST_FUNC_OPEN_RECHARGE_R]={id=_G.Const.CONST_FUNC_OPEN_RECHARGE,_data1=1},
    [_G.Const.CONST_FUNC_OPEN_RECHARGE_VIP_PRIVILEGE]={id=_G.Const.CONST_FUNC_OPEN_RECHARGE,_data1=2},
    -- [_G.Const.CONST_FUNC_OPEN_RECHARGE_S_FUND]={id=_G.Const.CONST_FUNC_OPEN_RECHARGE},
   --[_G.Const.CONST_FUNC_OPEN_RECHARGE_B_FUND]={id=_G.Const.CONST_FUNC_OPEN_RECHARGE},
    [_G.Const.CONST_FUNC_OPEN_RECHARGE_YUEKA]={id=_G.Const.CONST_FUNC_OPEN_RECHARGE,_data1=4},
    [_G.Const.CONST_FUNC_OPEN_RECHARGE_SUPREME]={id=_G.Const.CONST_FUNC_OPEN_RECHARGE,_data1=3},
    [_G.Const.CONST_FUNC_OPEN_RECHARGE_S_FUND]={id=_G.Const.CONST_FUNC_OPEN_RECHARGE,_data1=5},
    --神兵
    [_G.Const.CONST_FUNC_OPEN_ARTIFACT_EQUIP]={id=_G.Const.CONST_FUNC_OPEN_ARTIFACT,_data1=1},
    [_G.Const.CONST_FUNC_OPEN_ARTIFACT_STRENGTHEN]={id=_G.Const.CONST_FUNC_OPEN_ARTIFACT,_data1=2},
    [_G.Const.CONST_FUNC_OPEN_ARTIFACT_QUALITY]={id=_G.Const.CONST_FUNC_OPEN_ARTIFACT,_data1=3},
    [_G.Const.CONST_FUNC_OPEN_ARTIFACT_WASH]={id=_G.Const.CONST_FUNC_OPEN_ARTIFACT,_data1=4},
    --商城
    -- [_G.Const.CONST_FUNC_OPEN_SHOP_HOT]={id=_G.Const.CONST_FUNC_OPEN_SHOP},
    -- [_G.Const.CONST_FUNC_OPEN_SHOP_PROP]={id=_G.Const.CONST_FUNC_OPEN_SHOP},
    -- [_G.Const.CONST_FUNC_OPEN_SHOP_GEM]={id=_G.Const.CONST_FUNC_OPEN_SHOP},
    -- [_G.Const.CONST_FUNC_OPEN_SHOP_PACKAGE]={id=_G.Const.CONST_FUNC_OPEN_SHOP},
    -- [_G.Const.CONST_FUNC_OPEN_SHOP_YUANBAO]={id=_G.Const.CONST_FUNC_OPEN_SHOP},
    --节日活动
    [_G.Const.CONST_FUNC_OPEN_HOLIDAY_TURNTABLE]={id=_G.Const.CONST_FUNC_OPEN_HOLIDAY,_data1=1},
    [_G.Const.CONST_FUNC_OPEN_HOLIDAY_VALUELESS]={id=_G.Const.CONST_FUNC_OPEN_HOLIDAY,_data1=2},
    [_G.Const.CONST_FUNC_OPEN_HOLIDAY_GIVE]={id=_G.Const.CONST_FUNC_OPEN_HOLIDAY,_data1=3},
}

local OpenProxy = classGc( view, function( self)
    self.m_isInited  = false
    --功能开放
    self.m_sysCount  = 0
    self.m_sysIdList = {}

    -- 限时开放
    self.m_limitList = {}

    --促销活动
    self.m_subIdList = {}
    --体力领取按钮信息
    self.m_energyActivityData = nil

    -- 系统标点
    self.m_sysSignArray={}

    -- 新功能开放特效列表
    self.m_openEffectSysArray={}

    self.m_pMediator=require("mod.support.OpenProxyMediator")()
    self.m_pMediator:setView(self)
end)

OpenProxy.LimitOutsideArray={
    [_G.Const.CONST_FUNC_OPEN_HOLIDAY]=_G.Const.kMainIconPos5,-- 节日活动
    [_G.Const.CONST_FUNC_OPEN_REBATE]=_G.Const.kMainIconPos5,-- 精彩返利
    [_G.Const.CONST_FUNC_OPEN_GANGS_KING]=_G.Const.kMainIconPos5,--第一门派
    [_G.Const.CONST_FUNC_OPEN_SEVENDAY]=_G.Const.kMainIconPos5,--开服七日
    [_G.Const.CONST_FUNC_OPEN_EXAMINATION]=_G.Const.kMainIconPos5,--科举
    [_G.Const.CONST_FUNC_OPEN_GANGS_WAR]=_G.Const.kMainIconPos5,--门派大战
    [_G.Const.CONST_FUNC_OPEN_GANGS_DEFEND]=_G.Const.kMainIconPos5,--门派塔防
    [_G.Const.CONST_FUNC_OPEN_AUCTION]=_G.Const.kMainIconPos5,--拍卖活动
    [_G.Const.CONST_FUNC_OPEN_RUSH]=_G.Const.kMainIconPos5,--限时抢购
    [_G.Const.CONST_FUNC_OPEN_BOSS_SHIJIE]=_G.Const.kMainIconPos5,--勾魂使者-世界
    [_G.Const.CONST_FUNC_OPEN_BOSS_CHENGZHEN]=_G.Const.kMainIconPos5,--勾魂使者-城镇
    [_G.Const.CONST_FUNC_OPEN_STRIVE]=_G.Const.kMainIconPos5,--三界争锋
    [_G.Const.CONST_FUNC_OPEN_WELKIN_ONLY]=_G.Const.kMainIconPos5,--大闹天宫-太清混元
    [_G.Const.CONST_FUNC_OPEN_BOX]=_G.Const.kMainIconPos5,--秘宝活动
    [_G.Const.CONST_FUNC_OPEN_SRSC]=_G.Const.kMainIconPos6,--三日首充
    [_G.Const.CONST_FUNC_OPEN_GANGS_BOSS]=_G.Const.kMainIconPos5,--门派BOSS
}

function OpenProxy.setInited( self, _value)
    self.m_isInited=_value
end
function OpenProxy.getInited( self)
    return self.m_isInited
end

function OpenProxy.setCount( self, _value)
    self.m_sysCount=_value or 0
end
-- {数量}
function OpenProxy.getCount( self)
    return self.m_sysCount
end

-- {系统ID}
function OpenProxy.getSysId( self)
    return self.m_sysIdList
end
function OpenProxy.setSysId( self, _value)
    print("setSysId--->",_value)
    self.m_sysIdList = _value or {}
end

-- {获取功能总角标}
function OpenProxy.getSysIconNumber(self,_value)
    print("getSysIconNumber-->",_value)
    if self.m_sysIdList[_value]==nil then
        return 0
    else
        return self.m_sysIdList[_value].number or 0
    end
end

function OpenProxy.isSysOpen(self,_openId)
    -- print("isSysOpen============>>>>",_openId,self.m_sysIdList[_openId or 0])
    if not _openId then return false end
    return self.m_sysIdList[_openId]~=nil
end
function OpenProxy.showSysNoOpenTips(self,_openId,_noTips)
    -- print("TTTTT===================>>>",_openId,self.LimitOutsideArray[_openId],self.m_sysIdList[_openId],self.m_limitList[_openId])
    if _openId==nil then return false end

    if self.LimitOutsideArray[_openId] then
        if self.m_limitList[_openId]~=nil then
            return false
        end
    elseif self:isSysOpen(_openId) then
        return false
    end

    if _noTips then return true end

    local errorList = _G.Cfg.sys_open_info[_openId]
    if not errorList then return true end

    local command=CErrorBoxCommand(errorList.des)
    controller:sendCommand(command)
    return true
end

-- {限时开放}
function OpenProxy.getLimitId( self)
    return self.m_limitList
end
function OpenProxy.setLimitId( self, _value)
    self.m_limitList = _value or {}
end

function OpenProxy.getSysSignArray(self)
    return self.m_sysSignArray
end
function OpenProxy.addSysSign(self,_sysId)
    if self.m_sysSignArray[_sysId] then return end
    self.m_sysSignArray[_sysId]=1
    print("addSysSign-->",_sysId)
    local sendId=_sysId
    if _G.Cfg.P_SYS_ARRAY[_sysId] then
        local parentId=_G.Cfg.P_SYS_ARRAY[_sysId].id
        if self.m_sysSignArray[parentId] then
            self.m_sysSignArray[parentId]=self.m_sysSignArray[parentId]+1
            return
        end
        self.m_sysSignArray[parentId]=1
        sendId=parentId
    end

    local command=CFunctionSignCommand(CFunctionSignCommand.SIGN_ADD)
    command.sysId=sendId
    _G.controller:sendCommand(command)
end
function OpenProxy.delSysSign(self,_sysId)
    if not self.m_sysSignArray[_sysId] then return end
    self.m_sysSignArray[_sysId]=nil

    local sendId=_sysId
    if _G.Cfg.P_SYS_ARRAY[_sysId] then
        local parentId=_G.Cfg.P_SYS_ARRAY[_sysId].id
        if not self.m_sysSignArray[parentId] then return end

        self.m_sysSignArray[parentId]=self.m_sysSignArray[parentId]-1

        if self.m_sysSignArray[parentId]>0 then
            return
        end
        self.m_sysSignArray[parentId]=nil
        sendId=parentId
    end

    local command=CFunctionSignCommand(CFunctionSignCommand.SIGN_DEL)
    command.sysId=sendId
    _G.controller:sendCommand(command)
end

function OpenProxy.resetOpenEffectArray(self)
    self.m_openEffectSysArray={}
end
function OpenProxy.addOpenEffectSysId(self,_id)
    if self.m_openEffectSysArray[_id] then return end

    local openInfoCnf=_G.Cfg.sys_open_info[_id]
    if openInfoCnf==nil then
        return
    elseif openInfoCnf.open_effect==0 then
        return
    end

    self.m_openEffectSysArray[_id]=true
    self.m_openEffectSysArray[#self.m_openEffectSysArray+1]=_id

    local command = CFunctionOpenCommand(CFunctionOpenCommand.SHOW_EFFECT)
    command.sysId = _id
    controller:sendCommand(command)
end
function OpenProxy.delOpenEffectSysId(self,_id)
    if self.m_openEffectSysArray[_id] then
        for i=1,#self.m_openEffectSysArray do
            if self.m_openEffectSysArray[i]==_id then
                table.remove(self.m_openEffectSysArray,i)
                break
            end
        end
        self.m_openEffectSysArray[_id]=nil
    end
end
function OpenProxy.getOpenEffectSysArray(self)
    return self.m_openEffectSysArray
end

--得到功能开放ID 以及 子界面的数据
function OpenProxy.getFuncIdByOpenLayerId( self, _funcId )
    local funcId   = _funcId
    local tag      = nil
    if funcId == _G.Const.CONST_MAP_MALL then
        -- 邮件
        tag = _G.Const.CONST_FUNC_OPEN_MALL
    elseif funcId == _G.Const.CONST_MAP_CHATTING then
        -- 聊天
        tag = _G.Const.CONST_FUNC_OPEN_CHATTING
    elseif funcId == _G.Const.CONST_MAP_PAIHANG then
        -- 排行榜
        tag = _G.Const.CONST_FUNC_OPEN_CHATTING
    elseif funcId == _G.Const.CONST_MAP_STRATEGY then
        -- 攻略
        tag = _G.Const.CONST_FUNC_OPEN_STRATEGY
    elseif funcId == _G.Const.CONST_MAP_STRATEGY_CALENDAR then
        -- 攻略-活动日历
        tag = _G.Const.CONST_FUNC_OPEN_STRATEGY_CALENDAR
    elseif funcId == _G.Const.CONST_MAP_STRATEGY_ACTIVE then
        -- 攻略-今日活跃
        tag = _G.Const.CONST_FUNC_OPEN_STRATEGY_ACTIVE
    elseif funcId == _G.Const.CONST_MAP_STRATEGY_STRONG then
        -- 攻略-我要变强
        tag = _G.Const.CONST_FUNC_OPEN_STRATEGY_STRONG
    elseif funcId == _G.Const.CONST_MAP_SETING then
        -- 设置
        tag = _G.Const.CONST_FUNC_OPEN_SETING
    elseif funcId == _G.Const.CONST_MAP_SETING_UPDATE then
        -- 设置-更新公告
        tag = _G.Const.CONST_FUNC_OPEN_SETING_UPDATE
    elseif funcId == _G.Const.CONST_MAP_SETING_CONTACT_GM then
        -- 设置-联系GM
        tag = _G.Const.CONST_FUNC_OPEN_SETING_CONTACT_GM 
    elseif funcId == _G.Const.CONST_MAP_SETING_SUBMIT_BUG then
        -- 设置-提交BUG
        tag = _G.Const.CONST_FUNC_OPEN_SETING_SUBMIT_BUG
    elseif funcId == _G.Const.CONST_MAP_SETING_WEIXING then
        -- 设置-微信绑定
        tag = _G.Const.CONST_FUNC_OPEN_SETING_WEIXING
    elseif funcId == _G.Const.CONST_MAP_ROLE then
        -- 角色
        tag = _G.Const.CONST_FUNC_OPEN_ROLE
    elseif funcId == _G.Const.CONST_MAP_ROLE_ATTRIBUTE then
        -- 角色-属性
        tag = _G.Const.CONST_FUNC_OPEN_ROLE_ATTRIBUTE
    elseif funcId == _G.Const.CONST_MAP_ROLE_EQUIP then
        -- 角色-装备
        tag = _G.Const.CONST_FUNC_OPEN_ROLE_EQUIP
    elseif funcId == _G.Const.CONST_MAP_ROLE_TITLE then
        -- 角色-称号
        tag = _G.Const.CONST_FUNC_OPEN_ROLE_TITLE
    elseif funcId == _G.Const.CONST_MAP_ROLE_SKILL then
        -- 角色-技能
        tag = _G.Const.CONST_FUNC_OPEN_ROLE_SKILL
    elseif funcId == _G.Const.CONST_MAP_ROLE_GOLD then
        -- 角色-经脉
        tag = _G.Const.CONST_FUNC_OPEN_ROLE_GOLD
    elseif funcId == _G.Const.CONST_MAP_SMITHY then
        -- 湛卢坊
        tag = _G.Const.CONST_FUNC_OPEN_SMITHY
    elseif funcId == _G.Const.CONST_MAP_SMITHY_STRENGTHEN then
        -- 湛卢坊-强化
        tag = _G.Const.CONST_FUNC_OPEN_SMITHY_STRENGTHEN
    elseif funcId == _G.Const.CONST_MAP_SMITHY_QUALITY then
        -- 湛卢坊-升品
        tag = _G.Const.CONST_FUNC_OPEN_SMITHY_QUALITY
    elseif funcId == _G.Const.CONST_MAP_SMITHY_INLAY then
        -- 湛卢坊-镶嵌
        tag = _G.Const.CONST_FUNC_OPEN_SMITHY_INLAY
    elseif funcId == _G.Const.CONST_MAP_SMITHY_ENCHANTS then
        -- 湛卢坊-附魔
        tag = _G.Const.CONST_FUNC_OPEN_SMITHY_ENCHANTS
    elseif funcId == _G.Const.CONST_MAP_SMITHY_RESOLVE then
        -- 湛卢坊-分解
        tag = _G.Const.CONST_FUNC_OPEN_SMITHY_RESOLVE
    elseif funcId == _G.Const.CONST_MAP_MOUNT then
        -- 坐骑
        tag = _G.Const.CONST_FUNC_OPEN_MOUNT
    elseif funcId == _G.Const.CONST_MAP_FEATHER then
        -- 翅膀
        tag = _G.Const.CONST_FUNC_OPEN_FEATHER
    elseif funcId == _G.Const.CONST_MAP_BOX then
        -- 秘宝
        tag = _G.Const.CONST_FUNC_OPEN_BOX
    elseif funcId == _G.Const.CONST_MAP_WING then
        -- 宠物
        tag = _G.Const.CONST_FUNC_OPEN_WING
    elseif funcId == _G.Const.CONST_MAP_JEWELLERY then
        -- 珍宝
        -- tag = _G.Const.CONST_FUNC_OPEN_CHATTING

    elseif funcId == _G.Const.CONST_MAP_BAG then
        -- 背包
        tag = _G.Const.CONST_FUNC_OPEN_BAG
    elseif funcId == _G.Const.CONST_MAP_BAG_PROP then
        -- 背包-道具
        tag = _G.Const.CONST_FUNC_OPEN_BAG_PROP
    elseif funcId == _G.Const.CONST_MAP_BAG_GEM then
        -- 背包-宝石
        tag = _G.Const.CONST_FUNC_OPEN_BAG_GEM
    elseif funcId == _G.Const.CONST_MAP_BAG_EQUIP then
        -- 背包-装备
        tag = _G.Const.CONST_FUNC_OPEN_BAG_EQUIP
    elseif funcId == _G.Const.CONST_MAP_BAG_REPURCHASE then
        -- 背包-购回
        tag = _G.Const.CONST_FUNC_OPEN_BAG_REPURCHASE
    elseif funcId == _G.Const.CONST_MAP_BAG_COMPOSE then
        -- 背包-合成
        tag = _G.Const.CONST_FUNC_OPEN_BAG_COMPOSE

    elseif funcId == _G.Const.CONST_MAP_BEAUTY then
        -- 美人
        -- tag = _G.Const.CONST_FUNC_OPEN_CHATTING

    elseif funcId == _G.Const.CONST_MAP_TASK then
        -- 任务
        tag = _G.Const.CONST_FUNC_OPEN_TASK
    elseif funcId == _G.Const.CONST_MAP_TASK_THREAD then
        -- 任务-主线
        tag = _G.Const.CONST_FUNC_OPEN_TASK_THREAD
    elseif funcId == _G.Const.CONST_MAP_TASK_FEEDER then
        -- 任务-支线
        tag = _G.Const.CONST_FUNC_OPEN_TASK_FEEDER
    elseif funcId == _G.Const.CONST_MAP_TASK_DAILY then
        -- 任务-日常
        tag = _G.Const.CONST_FUNC_OPEN_TASK_DAILY
    elseif funcId == _G.Const.CONST_MAP_SHEN then
        -- 卦象
        tag = _G.Const.CONST_FUNC_OPEN_SHEN
    elseif funcId == _G.Const.CONST_MAP_SHEN_UP then
        -- 卦象-升级
        tag = _G.Const.CONST_FUNC_OPEN_SHEN_UP
    elseif funcId == _G.Const.CONST_MAP_SHEN_QUALITY then
        -- 卦象-升品
        tag = _G.Const.CONST_FUNC_OPEN_SHEN_QUALITY
    elseif funcId == _G.Const.CONST_MAP_PARTNER then
        -- 灵妖
        tag = _G.Const.CONST_FUNC_OPEN_PARTNER
    elseif funcId == _G.Const.CONST_MAP_PARTNER_ATTRIBUTE then
        -- 灵妖-属性
        tag = _G.Const.CONST_FUNC_OPEN_PARTNER_ATTRIBUTE
    elseif funcId == _G.Const.CONST_MAP_PARTNER_ADVANCED then
        -- 灵妖-进阶
        tag = _G.Const.CONST_FUNC_OPEN_PARTNER_ADVANCED
    elseif funcId == _G.Const.CONST_MAP_PARTNER_SOUL then
        -- 灵妖-炼魂
        tag = _G.Const.CONST_FUNC_OPEN_PARTNER_SOUL
    elseif funcId == _G.Const.CONST_MAP_PARTNER_CHEER then
        -- 灵妖-助阵
        tag = _G.Const.CONST_FUNC_OPEN_PARTNER_CHEER
    elseif funcId == _G.Const.CONST_MAP_PARTNER_ATLAS then
        -- 灵妖-图鉴
        tag = _G.Const.CONST_FUNC_OPEN_PARTNER_ATLAS
    elseif funcId == _G.Const.CONST_MAP_DAEMON then
        -- 仙宠灵兽
        tag = _G.Const.CONST_FUNC_OPEN_DAEMON

    elseif funcId == _G.Const.CONST_MAP_GANGS then
        -- 门派
        tag = _G.Const.CONST_FUNC_OPEN_GANGS
    elseif funcId == _G.Const.CONST_MAP_GANGS_BOSS then
        -- 门派活动-讨伐妖兽
        tag = _G.Const.CONST_FUNC_OPEN_GANGS_BOSS
    elseif funcId == _G.Const.CONST_MAP_GANGS_DEFEND then
        -- 门派活动-百鬼夜行堂
        tag = _G.Const.CONST_FUNC_OPEN_GANGS_DEFEND
    elseif funcId == _G.Const.CONST_MAP_GANGS_WAR then
        -- 门派活动-门派大战
        tag = _G.Const.CONST_FUNC_OPEN_GANGS_WAR
    elseif funcId == _G.Const.CONST_MAP_GANGS_KING then
        -- 门派活动-第一门派
        tag = _G.Const.CONST_FUNC_OPEN_GANGS_KING
    elseif funcId == _G.Const.CONST_MAP_GANGS_QIFU then
        -- 门派活动-祈福
        tag = _G.Const.CONST_FUNC_OPEN_GANGS_QIFU
    elseif funcId == _G.Const.CONST_MAP_GANGS_SKILL then
        -- 门派技能
        tag = _G.Const.CONST_FUNC_OPEN_GANGS_SKILL
    elseif funcId == _G.Const.CONST_MAP_FRIEND then
        -- 好友
        tag = _G.Const.CONST_FUNC_OPEN_FRIEND
    elseif funcId == _G.Const.CONST_MAP_FRIEND_WISH then
        -- 好友-祝福
        tag = _G.Const.CONST_FUNC_OPEN_FRIEND_WISH
    elseif funcId == _G.Const.CONST_MAP_ARENA then
        -- 竞技场
        tag = _G.Const.CONST_FUNC_OPEN_ARENA
    elseif funcId == _G.Const.CONST_MAP_LYJJ then
        -- 灵妖竞技
        tag = _G.Const.CONST_FUNC_OPEN_LYJJ
    elseif funcId == _G.Const.CONST_MAP_MOIL then
        -- 奴仆
        tag = _G.Const.CONST_FUNC_OPEN_MOIL
    elseif funcId == _G.Const.CONST_MAP_TOWER then
        -- 通天浮屠
        tag = _G.Const.CONST_FUNC_OPEN_TOWER
    elseif funcId == _G.Const.CONST_MAP_SURRENDER then
        -- 降魔之路
        tag = _G.Const.CONST_FUNC_OPEN_SURRENDER
    elseif funcId == _G.Const.CONST_MAP_JINGXIU then
        -- 浮屠静修
        tag = _G.Const.CONST_FUNC_OPEN_JINGXIU
    elseif funcId == _G.Const.CONST_MAP_MYTH then
        -- 封神榜
        tag = _G.Const.CONST_FUNC_OPEN_MYTH
    elseif funcId == _G.Const.CONST_MAP_WELKIN then
        -- 大闹天宫
        tag = _G.Const.CONST_FUNC_OPEN_WELKIN_FIRST
    elseif funcId == _G.Const.CONST_MAP_WELKIN_FIRST then
        -- 大闹天宫 - 玉清元始
        tag = _G.Const.CONST_FUNC_OPEN_WELKIN
    elseif funcId == _G.Const.CONST_MAP_WELKIN_BATTLE then
        -- 大闹天宫 - 巅峰之战
        tag = _G.Const.CONST_FUNC_OPEN_WELKIN_BATTLE
    elseif funcId == _G.Const.CONST_MAP_WELKIN_ONLY then
        -- 大闹天宫 - 太清混元
        tag = _G.Const.CONST_FUNC_OPEN_WELKIN_ONLY
    elseif funcId == _G.Const.CONST_MAP_STRIVE then
        -- 三界争锋
        tag = _G.Const.CONST_FUNC_OPEN_STRIVE

    elseif funcId == _G.Const.CONST_MAP_COPY then
        --副本
        tag = _G.Const.CONST_FUNC_OPEN_COPY
    elseif funcId == _G.Const.CONST_MAP_COPY_COMMON then
        --副本-普通
        tag = _G.Const.CONST_FUNC_OPEN_COPY_COMMON
    elseif funcId == _G.Const.CONST_MAP_COPY_NIGHTMARE then
        --副本-噩梦
        tag = _G.Const.CONST_FUNC_OPEN_COPY_NIGHTMARE
    elseif funcId == _G.Const.CONST_MAP_COPY_HELL then
        --副本-地狱
        tag = _G.Const.CONST_FUNC_OPEN_COPY_HELL
    elseif funcId == _G.Const.CONST_MAP_COPY_JEWELLERY then
        --副本-珍宝
        tag = _G.Const.CONST_FUNC_OPEN_COPY_JEWELLERY
    elseif funcId == _G.Const.CONST_MAP_TEAM then
        -- 群仙诛邪
        tag = _G.Const.CONST_FUNC_OPEN_TEAM
    elseif funcId == _G.Const.CONST_MAP_DEMONS then
        -- 无限心魔
        tag = _G.Const.CONST_FUNC_OPEN_DEMONS
    elseif funcId == _G.Const.CONST_MAP_BOSS then
        -- 勾魂使者
        tag = _G.Const.CONST_FUNC_OPEN_BOSS
    elseif funcId == _G.Const.CONST_MAP_BOSS_SHIJIE then 
        -- 勾魂使者-世界 
        tag = _G.Const.CONST_FUNC_OPEN_BOSS_SHIJIE
    elseif funcId == _G.Const.CONST_MAP_BOSS_CHENGZHEN then 
        -- 勾魂使者-城镇 
        tag = _G.Const.CONST_FUNC_OPEN_BOSS_CHENGZHEN  
    elseif funcId == _G.Const.CONST_MAP_TURNTABLE then
        -- 转盘抽奖
        -- tag = _G.Const.CONST_FUNC_OPEN_DAEMON
    elseif funcId == _G.Const.CONST_MAP_LUCKY then
        -- 祈福
         tag = _G.Const.CONST_FUNC_OPEN_LUCKY
    elseif funcId == _G.Const.CONST_MAP_CARDS then
        -- 对对牌
        tag = _G.Const.CONST_FUNC_OPEN_CARDS
    elseif funcId == _G.Const.CONST_MAP_GAMBLE then
        -- 翻翻乐
        tag = _G.Const.CONST_FUNC_OPEN_GAMBLE
    elseif funcId == _G.Const.CONST_MAP_RUSH then
        -- 限时抢购
        tag = _G.Const.CONST_FUNC_OPEN_RUSH
    elseif funcId == _G.Const.CONST_MAP_AUCTION then
        -- 拍卖活动
        tag = _G.Const.CONST_FUNC_OPEN_AUCTION
    elseif funcId == _G.Const.CONST_MAP_REBATE then
        -- 精彩返利
        tag = _G.Const.CONST_FUNC_OPEN_REBATE
    elseif funcId == _G.Const.CONST_MAP_HOLIDAY then
        -- 节日活动
        tag = _G.Const.CONST_FUNC_OPEN_HOLIDAY
    elseif funcId == _G.Const.CONST_MAP_HOLIDAY_TURNTABLE then
        -- 节日活动-节日转盘
        tag = _G.Const.CONST_FUNC_OPEN_HOLIDAY_TURNTABLE
    elseif funcId == _G.Const.CONST_MAP_HOLIDAY_VALUELESS then
        -- 节日活动-一字千金
        tag = _G.Const.CONST_FUNC_OPEN_HOLIDAY_VALUELESS
    elseif funcId == _G.Const.CONST_MAP_HOLIDAY_GIVE then
        -- 节日活动-登陆送礼
        tag = _G.Const.CONST_FUNC_OPEN_HOLIDAY_GIVE
    elseif funcId == _G.Const.CONST_MAP_WELFARE then
        -- 福利
        tag = _G.Const.CONST_FUNC_OPEN_WELFARE
    elseif funcId == _G.Const.CONST_MAP_REWARD_SIGN then
        -- 签到奖励
        tag = _G.Const.CONST_FUNC_OPEN_REWARD_SIGN
    elseif funcId == _G.Const.CONST_MAP_REWARD_ON_LINE then
        -- 在线奖励
        tag = _G.Const.CONST_FUNC_OPEN_REWARD_ON_LINE
    elseif funcId == _G.Const.CONST_MAP_REWARD_LV then
        -- 等级奖励
        tag = _G.Const.CONST_FUNC_OPEN_REWARD_LV
    elseif funcId == _G.Const.CONST_MAP_NOVICE then
        -- 礼包码
        tag = _G.Const.CONST_FUNC_OPEN_NOVICE
    elseif funcId == _G.Const.CONST_MAP_EXAMINATION then
        -- 御前科举
        tag = _G.Const.CONST_FUNC_OPEN_EXAMINATION
    elseif funcId == _G.Const.CONST_MAP_SEVENDAY then
        -- 开服七日
        tag = _G.Const.CONST_FUNC_OPEN_SEVENDAY
    elseif funcId == _G.Const.CONST_MAP_RECHARGE then
        -- 充值
        tag = _G.Const.CONST_FUNC_OPEN_RECHARGE
    elseif funcId == _G.Const.CONST_MAP_RECHARGE_R then
        -- 充值-充值
        tag = _G.Const.CONST_FUNC_OPEN_RECHARGE_R
    elseif funcId == _G.Const.CONST_MAP_RECHARGE_VIP_PRIVILEGE then
        -- 充值-vip特权
        print("vip特权",funcId)
        tag = _G.Const.CONST_FUNC_OPEN_RECHARGE_VIP_PRIVILEGE
    elseif funcId == _G.Const.CONST_MAP_RECHARGE_S_FUND then
        -- 充值-招财
        print("招财",funcId)

        tag = _G.Const.CONST_FUNC_OPEN_RECHARGE_S_FUND        
    -- elseif funcId == _G.Const.CONST_MAP_RECHARGE_S_FUND then
    --     -- 充值-月卡
    --     tag = _G.Const.CONST_FUNC_OPEN_RECHARGE_YUEKA
    -- elseif funcId == _G.Const.CONST_MAP_RECHARGE_S_FUND then
    --     -- 充值-平民基金
    --     tag = _G.Const.CONST_FUNC_OPEN_RECHARGE_S_FUND
    -- elseif funcId == _G.Const.CONST_MAP_RECHARGE_B_FUND then
    --     -- 充值-土豪基金
    --     tag = _G.Const.CONST_FUNC_OPEN_RECHARGE_B_FUND
    elseif funcId == _G.Const.CONST_MAP_RECHARGE_SUPREME then
        -- 充值-陨石商城
        tag = _G.Const.CONST_FUNC_OPEN_RECHARGE_SUPREME
    elseif funcId == _G.Const.CONST_MAP_EXAMINATION_DAILY then
        -- 每日首充
        tag = _G.Const.CONST_FUNC_OPEN_EXAMINATION_DAILY
    elseif funcId == _G.Const.CONST_MAP_SHOP then
        -- 商城
        tag = _G.Const.CONST_FUNC_OPEN_SHOP
    elseif funcId == _G.Const.CONST_MAP_CHENGJIU then
        -- 成就
        tag = _G.Const.CONST_FUNC_OPEN_CHENGJIU
    elseif funcId == _G.Const.CONST_MAP_DRAW then
        -- 抽奖
        -- tag = _G.Const.CONST_FUNC_OPEN_DAEMON
    elseif funcId == _G.Const.CONST_MAP_QILING then
        -- 武器
        tag = _G.Const.CONST_FUNC_OPEN_QILING
    elseif funcId == _G.Const.CONST_MAP_WELKIN then
        -- 大闹天宫
        tag = _G.Const.CONST_FUNC_OPEN_WELKIN
    elseif funcId == _G.Const.CONST_MAP_ARTIFACT then
        -- 神兵
        tag = _G.Const.CONST_FUNC_OPEN_ARTIFACT
    elseif funcId == _G.Const.CONST_MAP_ARTIFACT_EQUIP then
        -- 神兵装备
        tag = _G.Const.CONST_FUNC_OPEN_ARTIFACT_EQUIP
    elseif funcId == _G.Const.CONST_MAP_ARTIFACT_STRENGTHEN then
        -- 神兵强化
        tag = _G.Const.CONST_FUNC_OPEN_ARTIFACT_STRENGTHEN
    elseif funcId == _G.Const.CONST_MAP_ARTIFACT_QUALITY then
        -- 神兵进阶
        tag = _G.Const.CONST_FUNC_OPEN_ARTIFACT_QUALITY
    elseif funcId == _G.Const.CONST_MAP_ARTIFACT_WASH then
        -- 神兵洗练
        tag = _G.Const.CONST_FUNC_OPEN_ARTIFACT_WASH
    end
    return tag
end

function OpenProxy.addTextOpenData(self,_sender)
    if self.m_isAddText then return end
    self.m_isAddText=true

    local sysArray = {}
    for k,v in pairs(_G.Cfg.sys_open_info) do
        sysArray[k]=true
    end
    sysArray[_G.Const.CONST_FUNC_OPEN_ENARGY]=nil

    local curArray=clone(self:getSysId())
    local cArray={}
    local cCount=self:getCount()
    for key,value in pairs(sysArray) do
        if curArray[key]==nil then
            curArray[key]={}
            curArray[key].id=key
            curArray[key].state=_G.Const.CONST_ACTIVITY_ZHENGCHANG
            curArray[key].number=0
            table.insert(cArray,key)
            cCount=cCount+1
        end
    end

    self.m_pMediator:ACK_ROLE_SYS_ID_2({count=cCount,sys_id=curArray},true)
    -- self:setCount(cCount)
    -- self:setInited(true)

    -- if #cArray > 0 then
    --     local command=CFunctionOpenCommand( CFunctionOpenCommand.UPDATE )
    --     command.chuangeIdList=cArray
    --     _G.controller:sendCommand(command)
    -- end

    -- _sender:setString("【临时中..】")
end

------------------------------------------------------------
------------------------------------------------------------
--新添的缓存信息都在这儿-- 

--æææææææææææææææææææææææ
--促销活动  已领取的subid  集合
--æææææææææææææææææææææææ
function OpenProxy.resetSubIdList( self, _list )
    if _list == nil then
        return
    end
    self.m_subIdList = _list or {}

    print("---------resetSubIdList---------")
    for idstep,v in pairs(self.m_subIdList) do
        print("    已领取的subId-->"..idstep)
    end
end

function OpenProxy.getSubIdList( self )
    return self.m_subIdList
end

function OpenProxy.isSubIdHere( self, _subId )
    print("isSubIdHere--->",_subId,self.m_subIdList[_subId])
    return self.m_subIdList[_subId]
end


------------------------------------------------------------
--体力领取按钮
function OpenProxy.setEnergyBuffActivityInfo( self, _value )
    self.m_energyActivityData = _value
end

function OpenProxy.getEnergyBuffActivityInfo( self)
    return self.m_energyActivityData
end

return OpenProxy